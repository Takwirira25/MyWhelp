<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWhelp - Cloud System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            flex-grow: 1; /* Allow container to grow and push footer down */
        }
        .gradient-text {
            background: linear-gradient(90deg, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            background-color: #2d3748; /* Slightly lighter dark for cards */
            border-radius: 0.75rem; /* Rounded corners */
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-primary {
            background-color: #6366f1;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            color: #a0aec0; /* Gray text for inactive links */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .nav-link:hover {
            background-color: #4a5568; /* Darker gray on hover */
            color: #cbd5e0; /* Lighter text on hover */
        }
        .nav-link.active {
            background-color: #6366f1; /* Primary color for active link */
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Global variables provided by the Canvas environment (mocked for direct HTML run)
        const __app_id = 'mywhelp-demo-app'; // Example app ID
        const __firebase_config = JSON.stringify({
            apiKey: "YOUR_FIREBASE_API_KEY", // Replace with your Firebase project's API Key
            authDomain: "YOUR_FIREBASE_AUTH_DOMAIN", // Replace with your Firebase project's Auth Domain
            projectId: "YOUR_FIREBASE_PROJECT_ID",   // Replace with your Firebase project's Project ID
            storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET", // Replace with your Firebase project's Storage Bucket
            messagingSenderId: "YOUR_FIREBASE_MESSAGING_SENDER_ID", // Replace with your Firebase project's Messaging Sender ID
            appId: "YOUR_FIREBASE_APP_ID" // Replace with your Firebase project's App ID
        });
        const __initial_auth_token = null; // Or a token if you have one for initial sign-in

        // Firebase imports from CDN
        const { initializeApp } = firebase;
        const {
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updateEmail,
            updatePassword
        } = firebase.auth;
        const {
            getFirestore,
            collection,
            doc,
            addDoc,
            getDocs,
            deleteDoc,
            onSnapshot,
            serverTimestamp,
            query,
            where
        } = firebase.firestore;
        const {
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL,
            deleteObject
        } = firebase.storage;

        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // Modal Component for custom alerts/confirmations
        const Modal = ({ show, message, type, onClose }) => {
            if (!show) return null;

            const bgColor = type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const textColor = 'text-white';

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className={`rounded-xl shadow-lg p-6 max-w-sm w-full ${bgColor} ${textColor} transform transition-all duration-300 scale-105`}>
                        <h3 className="text-xl font-semibold mb-4">{type === 'error' ? 'Error' : 'Notification'}</h3>
                        <p className="mb-6">{message}</p>
                        <div className="flex justify-end">
                            <button
                                onClick={onClose}
                                className="px-5 py-2 bg-white text-gray-800 rounded-lg font-semibold hover:bg-gray-200 transition duration-200"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Navigation Component
        const Navbar = ({ currentView, setView, currentUser, handleLogout }) => {
            return (
                <nav className="bg-gray-900 p-4 shadow-md">
                    <div className="container flex justify-between items-center">
                        <h1 className="text-2xl font-bold gradient-text">MyWhelp</h1>
                        {currentUser && (
                            <div className="flex space-x-4">
                                <button
                                    onClick={() => setView('dashboard')}
                                    className={`nav-link ${currentView === 'dashboard' ? 'active' : ''}`}
                                >
                                    Dashboard
                                </button>
                                <button
                                    onClick={() => setView('documents')}
                                    className={`nav-link ${currentView === 'documents' ? 'active' : ''}`}
                                >
                                    Documents
                                </button>
                                <button
                                    onClick={() => setView('reports')}
                                    className={`nav-link ${currentView === 'reports' ? 'active' : ''}`}
                                >
                                    Reports
                                </button>
                                <button
                                    onClick={() => setView('account')}
                                    className={`nav-link ${currentView === 'account' ? 'active' : ''}`}
                                >
                                    Account
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition duration-200"
                                >
                                    Logout
                                </button>
                            </div>
                        )}
                    </div>
                </nav>
            );
        };

        // Main App Component
        const App = () => {
            const [view, setView] = useState('auth'); // 'auth', 'dashboard', 'documents', 'reports', 'account'
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [currentUser, setCurrentUser] = useState(null);
            const [userId, setUserId] = useState(null);
            const [loading, setLoading] = useState(true);
            const [firebaseInitialized, setFirebaseInitialized] = useState(false);

            const [documents, setDocuments] = useState([]);
            const [selectedFile, setSelectedFile] = useState(null);
            const [uploading, setUploading] = useState(false);

            const [reports, setReports] = useState([]);
            const [newReportTitle, setNewReportTitle] = useState('');
            const [newReportDate, setNewReportDate] = useState('');
            const [reportRows, setReportRows] = useState([{ item: '', description: '', value: '' }]);
            const [selectedReport, setSelectedReport] = useState(null);
            const reportTableRef = useRef(null); // Ref for the report table to convert to PDF

            // Modal state
            const [showModal, setShowModal] = useState(false);
            const [modalMessage, setModalMessage] = useState('');
            const [modalType, setModalType] = useState('notification'); // 'notification' or 'error'

            // Firebase instances
            const appRef = useRef(null);
            const authRef = useRef(null);
            const dbRef = useRef(null);
            const storageRef = useRef(null);

            // Initialize Firebase and set up auth listener
            useEffect(() => {
                const firebaseConfigParsed = JSON.parse(__firebase_config);
                if (Object.keys(firebaseConfigParsed).length === 0 || !firebaseConfigParsed.apiKey) {
                    console.error("Firebase config is missing or incomplete. Cannot initialize Firebase.");
                    setLoading(false);
                    setModalMessage("Firebase configuration is missing. Please ensure it's provided in the code.");
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                try {
                    const app = initializeApp(firebaseConfigParsed);
                    const auth = getAuth(app);
                    const db = getFirestore(app);
                    const storage = getStorage(app);

                    appRef.current = app;
                    authRef.current = auth;
                    dbRef.current = db;
                    storageRef.current = storage;

                    setFirebaseInitialized(true);

                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            setCurrentUser(user);
                            setUserId(user.uid);
                            setView('dashboard'); // Redirect to dashboard on login
                            console.log("User logged in:", user.uid);
                        } else {
                            setCurrentUser(null);
                            setUserId(null);
                            setView('auth'); // Redirect to auth if logged out
                            console.log("User logged out or not authenticated.");
                            // Attempt anonymous sign-in if no initialAuthToken is provided
                            if (!__initial_auth_token) {
                                try {
                                    await signInAnonymously(auth);
                                    console.log("Signed in anonymously.");
                                } catch (anonError) {
                                    console.error("Error signing in anonymously:", anonError);
                                    setModalMessage(`Failed to sign in anonymously: ${anonError.message}`);
                                    setModalType('error');
                                    setShowModal(true);
                                }
                            }
                        }
                        setLoading(false);
                    });

                    // Use the initial auth token if provided
                    const signInWithToken = async () => {
                        if (__initial_auth_token) {
                            try {
                                await signInWithCustomToken(auth, __initial_auth_token);
                                console.log("Signed in with custom token.");
                            } catch (error) {
                                console.error("Error signing in with custom token:", error);
                                setModalMessage(`Failed to sign in with custom token: ${error.message}`);
                                setModalType('error');
                                setShowModal(true);
                            }
                        }
                    };
                    signInWithToken();

                    return () => unsubscribe(); // Cleanup auth listener
                } catch (error) {
                    console.error("Error initializing Firebase:", error);
                    setModalMessage(`Failed to initialize Firebase: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                    setLoading(false);
                }
            }, []); // Empty dependency array means this runs once on mount

            // Fetch documents and reports when userId is available
            useEffect(() => {
                if (userId && firebaseInitialized && dbRef.current) {
                    // Fetch documents
                    const docsCollectionRef = collection(dbRef.current, `artifacts/${__app_id}/users/${userId}/documents`);
                    const unsubscribeDocs = onSnapshot(docsCollectionRef, (snapshot) => {
                        const fetchedDocs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setDocuments(fetchedDocs);
                    }, (error) => {
                        console.error("Error fetching documents:", error);
                        setModalMessage(`Failed to load documents: ${error.message}`);
                        setModalType('error');
                        setShowModal(true);
                    });

                    // Fetch reports
                    const reportsCollectionRef = collection(dbRef.current, `artifacts/${__app_id}/users/${userId}/reports`);
                    const unsubscribeReports = onSnapshot(reportsCollectionRef, (snapshot) => {
                        const fetchedReports = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setReports(fetchedReports);
                    }, (error) => {
                        console.error("Error fetching reports:", error);
                        setModalMessage(`Failed to load reports: ${error.message}`);
                        setModalType('error');
                        setShowModal(true);
                    });

                    return () => {
                        unsubscribeDocs();
                        unsubscribeReports();
                    }; // Cleanup listeners
                }
            }, [userId, firebaseInitialized]); // Re-run when userId or firebaseInitialized changes

            const handleAuthAction = async (isSignUp) => {
                if (!authRef.current) return;
                setLoading(true);
                try {
                    if (isSignUp) {
                        await createUserWithEmailAndPassword(authRef.current, email, password);
                        setModalMessage('Account created successfully! You are now logged in.');
                        setModalType('notification');
                    } else {
                        await signInWithEmailAndPassword(authRef.current, email, password);
                        setModalMessage('Logged in successfully!');
                        setModalType('notification');
                    }
                    setShowModal(true);
                    setEmail('');
                    setPassword('');
                } catch (error) {
                    console.error("Authentication error:", error);
                    setModalMessage(`Authentication failed: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = async () => {
                if (!authRef.current) return;
                setLoading(true);
                try {
                    await signOut(authRef.current);
                    setModalMessage('Logged out successfully.');
                    setModalType('notification');
                    setShowModal(true);
                    setView('auth'); // Go back to auth page
                } catch (error) {
                    console.error("Logout error:", error);
                    setModalMessage(`Logout failed: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                } finally {
                    setLoading(false);
                }
            };

            const handleFileChange = (e) => {
                setSelectedFile(e.target.files[0]);
            };

            const handleUploadDocument = async () => {
                if (!selectedFile || !userId || !storageRef.current || !dbRef.current) {
                    setModalMessage('Please select a file and ensure you are logged in.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                setUploading(true);
                try {
                    const storagePath = `documents/${userId}/${selectedFile.name}`;
                    const fileRef = ref(storageRef.current, storagePath);
                    await uploadBytes(fileRef, selectedFile);
                    const downloadURL = await getDownloadURL(fileRef);

                    // Save document metadata to Firestore
                    await addDoc(collection(dbRef.current, `artifacts/${__app_id}/users/${userId}/documents`), {
                        name: selectedFile.name,
                        url: downloadURL,
                        uploadedAt: serverTimestamp(),
                        userId: userId
                    });

                    setModalMessage('Document uploaded successfully!');
                    setModalType('notification');
                    setShowModal(true);
                    setSelectedFile(null); // Clear selected file
                } catch (error) {
                    console.error("Error uploading document:", error);
                    setModalMessage(`Document upload failed: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                } finally {
                    setUploading(false);
                }
            };

            const handleDeleteDocument = async (docId, fileName) => {
                if (!userId || !storageRef.current || !dbRef.current) {
                    setModalMessage('You must be logged in to delete documents.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                if (window.confirm(`Are you sure you want to delete "${fileName}"?`)) {
                    try {
                        // Delete from Firebase Storage
                        const fileRef = ref(storageRef.current, `documents/${userId}/${fileName}`);
                        await deleteObject(fileRef);

                        // Delete from Firestore
                        await deleteDoc(doc(dbRef.current, `artifacts/${__app_id}/users/${userId}/documents`, docId));

                        setModalMessage('Document deleted successfully!');
                        setModalType('notification');
                        setShowModal(true);
                    } catch (error) {
                        console.error("Error deleting document:", error);
                        setModalMessage(`Document deletion failed: ${error.message}`);
                        setModalType('error');
                        setShowModal(true);
                    }
                }
            };

            const handleAddReportRow = () => {
                setReportRows([...reportRows, { item: '', description: '', value: '' }]);
            };

            const handleRemoveReportRow = (index) => {
                const newRows = reportRows.filter((_, i) => i !== index);
                setReportRows(newRows);
            };

            const handleReportRowChange = (index, field, value) => {
                const newRows = [...reportRows];
                newRows[index][field] = value;
                setReportRows(newRows);
            };

            const handleSaveReport = async () => {
                if (!newReportTitle || !newReportDate || reportRows.length === 0 || !userId || !dbRef.current) {
                    setModalMessage('Please fill in all report details and add at least one row.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                setLoading(true);
                try {
                    await addDoc(collection(dbRef.current, `artifacts/${__app_id}/users/${userId}/reports`), {
                        title: newReportTitle,
                        date: newReportDate,
                        content: JSON.stringify(reportRows), // Store as JSON string
                        createdAt: serverTimestamp(),
                        userId: userId
                    });

                    setModalMessage('Report saved successfully!');
                    setModalType('notification');
                    setShowModal(true);
                    setNewReportTitle('');
                    setNewReportDate('');
                    setReportRows([{ item: '', description: '', value: '' }]); // Reset form
                } catch (error) {
                    console.error("Error saving report:", error);
                    setModalMessage(`Failed to save report: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                } finally {
                    setLoading(false);
                }
            };

            const handleDeleteReport = async (reportId, reportTitle) => {
                if (!userId || !dbRef.current) {
                    setModalMessage('You must be logged in to delete reports.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                if (window.confirm(`Are you sure you want to delete "${reportTitle}"?`)) {
                    try {
                        await deleteDoc(doc(dbRef.current, `artifacts/${__app_id}/users/${userId}/reports`, reportId));
                        setModalMessage('Report deleted successfully!');
                        setModalType('notification');
                        setShowModal(true);
                        setSelectedReport(null); // Deselect report if it was the one deleted
                    } catch (error) {
                        console.error("Error deleting report:", error);
                        setModalMessage(`Report deletion failed: ${error.message}`);
                        setModalType('error');
                        setShowModal(true);
                    }
                }
            };

            const handleGeneratePdf = () => {
                if (!selectedReport || !reportTableRef.current) {
                    setModalMessage('Please select a report to generate PDF.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                setLoading(true);
                try {
                    // Ensure jsPDF and html2canvas are loaded (they should be via CDN in the HTML)
                    if (typeof window.jsPDF === 'undefined' || typeof window.html2canvas === 'undefined') {
                        setModalMessage('PDF generation libraries (jsPDF, html2canvas) are not loaded. Please ensure CDNs are correctly linked.');
                        setModalType('error');
                        setShowModal(true);
                        setLoading(false);
                        return;
                    }

                    const input = reportTableRef.current;
                    html2canvas(input, {
                        scale: 2, // Increase scale for better quality
                        useCORS: true // Important for images, though we don't have them here
                    }).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new window.jsPDF('p', 'mm', 'a4'); // 'p' for portrait, 'mm' for units, 'a4' for size
                        const imgWidth = 210; // A4 width in mm
                        const pageHeight = 297; // A4 height in mm
                        const imgHeight = canvas.height * imgWidth / canvas.width;
                        let heightLeft = imgHeight;
                        let position = 0;

                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;

                        while (heightLeft >= 0) {
                            position = heightLeft - imgHeight;
                            pdf.addPage();
                            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                            heightLeft -= pageHeight;
                        }

                        pdf.save(`${selectedReport.title}_${selectedReport.date}.pdf`);
                        setModalMessage('PDF generated successfully!');
                        setModalType('notification');
                        setShowModal(true);
                    }).catch(error => {
                        console.error("Error generating PDF:", error);
                        setModalMessage(`Failed to generate PDF: ${error.message}`);
                        setModalType('error');
                        setShowModal(true);
                    }).finally(() => {
                        setLoading(false);
                    });
                } catch (error) {
                    console.error("PDF generation setup error:", error);
                    setModalMessage(`PDF generation failed: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                    setLoading(false);
                }
            };

            const handleUpdateAccount = async (newEmail, newPassword) => {
                if (!currentUser) {
                    setModalMessage('You must be logged in to update your account.');
                    setModalType('error');
                    setShowModal(true);
                    return;
                }

                setLoading(true);
                try {
                    if (newEmail && newEmail !== currentUser.email) {
                        await updateEmail(currentUser, newEmail);
                        setModalMessage('Email updated successfully!');
                        setModalType('notification');
                        setShowModal(true);
                    }
                    if (newPassword) {
                        await updatePassword(currentUser, newPassword);
                        setModalMessage(prev => prev + (prev ? ' And ' : '') + 'Password updated successfully!');
                        setModalType('notification');
                        setShowModal(true);
                    }
                } catch (error) {
                    console.error("Error updating account:", error);
                    setModalMessage(`Failed to update account: ${error.message}`);
                    setModalType('error');
                    setShowModal(true);
                } finally {
                    setLoading(false);
                }
            };

            const renderAuth = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-4">
                    <div className="bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-md">
                        <h2 className="text-3xl font-bold text-center mb-8 gradient-text">MyWhelp</h2>
                        <input
                            type="email"
                            placeholder="Email"
                            className="w-full p-3 mb-4 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                        />
                        <input
                            type="password"
                            placeholder="Password"
                            className="w-full p-3 mb-6 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                        />
                        <button
                            onClick={() => handleAuthAction(false)}
                            className="w-full btn-primary mb-4"
                            disabled={loading}
                        >
                            {loading ? 'Logging In...' : 'Login'}
                        </button>
                        <button
                            onClick={() => handleAuthAction(true)}
                            className="w-full btn-primary bg-purple-600 hover:bg-purple-700"
                            disabled={loading}
                        >
                            {loading ? 'Creating Account...' : 'Create Account'}
                        </button>
                        {userId && ( // Show user ID if anonymously logged in
                            <p className="text-gray-400 text-sm mt-4 text-center">
                                Current User ID: <span className="font-mono text-gray-300 break-all">{userId}</span>
                            </p>
                        )}
                    </div>
                </div>
            );

            const renderDashboard = () => (
                <div className="p-6 container mx-auto">
                    <h2 className="text-4xl font-bold mb-8 gradient-text">Dashboard</h2>
                    <p className="text-lg text-gray-300 mb-6">Welcome, {currentUser?.email || 'User'}!</p>
                    <p className="text-gray-400 text-sm mb-8">
                        Your User ID: <span className="font-mono text-gray-300 break-all">{userId}</span>
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div className="card text-center">
                            <h3 className="text-2xl font-semibold mb-3 text-white">Documents</h3>
                            <p className="text-gray-400 mb-4">Manage your stored files.</p>
                            <button onClick={() => setView('documents')} className="btn-primary">Go to Documents</button>
                        </div>
                        <div className="card text-center">
                            <h3 className="text-2xl font-semibold mb-3 text-white">Reports</h3>
                            <p className="text-gray-400 mb-4">Create and view weekly reports.</p>
                            <button onClick={() => setView('reports')} className="btn-primary">Go to Reports</button>
                        </div>
                        <div className="card text-center">
                            <h3 className="text-2xl font-semibold mb-3 text-white">Account Settings</h3>
                            <p className="text-gray-400 mb-4">Manage your profile and security.</p>
                            <button onClick={() => setView('account')} className="btn-primary">Go to Account</button>
                        </div>
                    </div>
                </div>
            );

            const renderDocuments = () => (
                <div className="p-6 container mx-auto">
                    <h2 className="text-4xl font-bold mb-8 gradient-text">Documents</h2>
                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                        <h3 className="text-2xl font-semibold mb-4 text-white">Upload New Document</h3>
                        <input
                            type="file"
                            onChange={handleFileChange}
                            className="w-full p-3 mb-4 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-500 file:text-white hover:file:bg-purple-600"
                        />
                        <button
                            onClick={handleUploadDocument}
                            className="btn-primary w-full"
                            disabled={uploading || !selectedFile}
                        >
                            {uploading ? 'Uploading...' : 'Upload Document'}
                        </button>
                    </div>

                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 className="text-2xl font-semibold mb-4 text-white">Your Documents</h3>
                        {documents.length === 0 ? (
                            <p className="text-gray-400">No documents uploaded yet.</p>
                        ) : (
                            <ul className="space-y-4">
                                {documents.map((doc) => (
                                    <li key={doc.id} className="flex flex-col sm:flex-row justify-between items-center bg-gray-700 p-4 rounded-lg shadow-md">
                                        <span className="text-white text-lg break-all mb-2 sm:mb-0 sm:mr-4 text-center sm:text-left">{doc.name}</span>
                                        <div className="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
                                            <a
                                                href={doc.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200 text-sm text-center"
                                            >
                                                Download
                                            </a>
                                            <button
                                                onClick={() => handleDeleteDocument(doc.id, doc.name)}
                                                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200 text-sm text-center"
                                            >
                                                Delete
                                            </button>
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </div>
                </div>
            );

            const renderReports = () => (
                <div className="p-6 container mx-auto">
                    <h2 className="text-4xl font-bold mb-8 gradient-text">Reports</h2>

                    {/* Create New Report Section */}
                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                        <h3 className="text-2xl font-semibold mb-4 text-white">Create New Weekly Report</h3>
                        <input
                            type="text"
                            placeholder="Report Title (e.g., Q2 2025 Performance)"
                            className="w-full p-3 mb-4 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value={newReportTitle}
                            onChange={(e) => setNewReportTitle(e.target.value)}
                        />
                        <input
                            type="date"
                            placeholder="Week Ending Date"
                            className="w-full p-3 mb-4 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value={newReportDate}
                            onChange={(e) => setNewReportDate(e.target.value)}
                        />

                        <h4 className="text-xl font-semibold mb-3 text-white">Report Content (Table)</h4>
                        <div className="space-y-3 mb-4">
                            {reportRows.map((row, index) => (
                                <div key={index} className="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-3 bg-gray-700 p-3 rounded-lg">
                                    <input
                                        type="text"
                                        placeholder="Item"
                                        className="flex-1 p-2 rounded-lg bg-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-purple-500"
                                        value={row.item}
                                        onChange={(e) => handleReportRowChange(index, 'item', e.target.value)}
                                    />
                                    <input
                                        type="text"
                                        placeholder="Description"
                                        className="flex-1 p-2 rounded-lg bg-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-purple-500"
                                        value={row.description}
                                        onChange={(e) => handleReportRowChange(index, 'description', e.target.value)}
                                    />
                                    <input
                                        type="text"
                                        placeholder="Value"
                                        className="w-24 p-2 rounded-lg bg-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-purple-500"
                                        value={row.value}
                                        onChange={(e) => handleReportRowChange(index, 'value', e.target.value)}
                                    />
                                    <button
                                        onClick={() => handleRemoveReportRow(index)}
                                        className="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-200 text-sm"
                                    >
                                        Remove
                                    </button>
                                </div>
                            ))}
                        </div>
                        <button onClick={handleAddReportRow} className="btn-primary bg-green-600 hover:bg-green-700 mb-4">
                            Add Row
                        </button>
                        <button onClick={handleSaveReport} className="btn-primary w-full" disabled={loading}>
                            {loading ? 'Saving Report...' : 'Save Report'}
                        </button>
                    </div>

                    {/* Your Reports Section */}
                    <div className="bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 className="text-2xl font-semibold mb-4 text-white">Your Saved Reports</h3>
                        {reports.length === 0 ? (
                            <p className="text-gray-400">No reports saved yet.</p>
                        ) : (
                            <ul className="space-y-4 mb-6">
                                {reports.map((report) => (
                                    <li key={report.id} className="flex flex-col sm:flex-row justify-between items-center bg-gray-700 p-4 rounded-lg shadow-md">
                                        <span className="text-white text-lg break-all mb-2 sm:mb-0 sm:mr-4">
                                            {report.title} - {report.date}
                                        </span>
                                        <div className="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
                                            <button
                                                onClick={() => setSelectedReport(report)}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200 text-sm text-center"
                                            >
                                                View Details
                                            </button>
                                            <button
                                                onClick={() => handleDeleteReport(report.id, report.title)}
                                                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200 text-sm text-center"
                                            >
                                                Delete
                                            </button>
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        )}

                        {selectedReport && (
                            <div className="bg-gray-700 p-6 rounded-xl shadow-inner mt-8">
                                <h4 className="text-2xl font-semibold mb-4 text-white">Report Details: {selectedReport.title} ({selectedReport.date})</h4>
                                <div ref={reportTableRef} className="overflow-x-auto">
                                    <table className="min-w-full bg-gray-800 rounded-lg overflow-hidden">
                                        <thead>
                                            <tr className="bg-gray-600 text-white">
                                                <th className="py-3 px-4 text-left">Item</th>
                                                <th className="py-3 px-4 text-left">Description</th>
                                                <th className="py-3 px-4 text-left">Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {JSON.parse(selectedReport.content).map((row, index) => (
                                                <tr key={index} className="border-b border-gray-700 last:border-0">
                                                    <td className="py-3 px-4">{row.item}</td>
                                                    <td className="py-3 px-4">{row.description}</td>
                                                    <td className="py-3 px-4">{row.value}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <button onClick={handleGeneratePdf} className="btn-primary mt-6 w-full md:w-auto">
                                    Generate PDF
                                </button>
                                <button onClick={() => setSelectedReport(null)} className="btn-primary bg-gray-500 hover:bg-gray-600 mt-4 md:mt-6 ml-0 md:ml-4 w-full md:w-auto">
                                    Close Details
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );

            const renderAccount = () => {
                const [newEmail, setNewEmail] = useState(currentUser?.email || '');
                const [newPassword, setNewPassword] = useState('');
                const [confirmNewPassword, setConfirmNewPassword] = useState('');

                const handleUpdateClick = () => {
                    if (newPassword && newPassword !== confirmNewPassword) {
                        setModalMessage('New password and confirmation do not match.');
                        setModalType('error');
                        setShowModal(true);
                        return;
                    }
                    handleUpdateAccount(newEmail, newPassword);
                    setNewPassword('');
                    setConfirmNewPassword('');
                };

                return (
                    <div className="p-6 container mx-auto">
                        <h2 className="text-4xl font-bold mb-8 gradient-text">Account Settings</h2>
                        <div className="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                            <h3 className="text-2xl font-semibold mb-4 text-white">Profile Information</h3>
                            <p className="text-gray-300 mb-4">
                                **User ID:** <span className="font-mono text-gray-300 break-all">{userId}</span>
                            </p>
                            <div className="mb-4">
                                <label htmlFor="email" className="block text-gray-400 text-sm font-bold mb-2">Email:</label>
                                <input
                                    type="email"
                                    id="email"
                                    className="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    value={newEmail}
                                    onChange={(e) => setNewEmail(e.target.value)}
                                    placeholder="Your email address"
                                />
                            </div>
                            <h3 className="text-2xl font-semibold mb-4 text-white mt-8">Change Password</h3>
                            <div className="mb-4">
                                <label htmlFor="new-password" className="block text-gray-400 text-sm font-bold mb-2">New Password:</label>
                                <input
                                    type="password"
                                    id="new-password"
                                    className="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    value={newPassword}
                                    onChange={(e) => setNewPassword(e.target.value)}
                                    placeholder="Enter new password (min 6 characters)"
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="confirm-new-password" className="block text-gray-400 text-sm font-bold mb-2">Confirm New Password:</label>
                                <input
                                    type="password"
                                    id="confirm-new-password"
                                    className="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    value={confirmNewPassword}
                                    onChange={(e) => setConfirmNewPassword(e.target.value)}
                                    placeholder="Confirm new password"
                                />
                            </div>
                            <button
                                onClick={handleUpdateClick}
                                className="btn-primary w-full"
                                disabled={loading}
                            >
                                {loading ? 'Updating...' : 'Update Account'}
                            </button>
                            <button
                                onClick={handleLogout}
                                className="w-full btn-primary bg-red-600 hover:bg-red-700 mt-4"
                                disabled={loading}
                            >
                                Logout
                            </button>
                        </div>
                    </div>
                );
            };

            const renderContent = () => {
                if (loading) {
                    return (
                        <div className="flex justify-center items-center min-h-screen">
                            <div className="text-xl text-gray-300">Loading...</div>
                        </div>
                    );
                }

                if (!firebaseInitialized) {
                    return (
                        <div className="flex justify-center items-center min-h-screen">
                            <div className="text-xl text-red-400">Firebase failed to initialize. Please check console for errors.</div>
                        </div>
                    );
                }

                switch (view) {
                    case 'auth':
                        return renderAuth();
                    case 'dashboard':
                        return renderDashboard();
                    case 'documents':
                        return renderDocuments();
                    case 'reports':
                        return renderReports();
                    case 'account':
                        return renderAccount();
                    default:
                        return renderAuth();
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {currentUser && <Navbar currentView={view} setView={setView} currentUser={currentUser} handleLogout={handleLogout} />}
                    <main className="flex-grow">
                        {renderContent()}
                    </main>
                    <Modal show={showModal} message={modalMessage} type={modalType} onClose={() => setShowModal(false)} />
                </div>
            );
        };

        const domNode = document.getElementById('root');
        const root = createRoot(domNode);
        root.render(<App />);
    </script>
</body>
</html>
