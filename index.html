<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyWhelp Cloud System</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Cinzel:wght@600&display=swap" rel="stylesheet"/>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    /* Custom styles for the Cinzel font for the header */
    .font-cinzel {
      font-family: 'Cinzel', serif;
    }
    /* Ensure body uses Inter font by default for consistent styling */
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Modals need flex display to center content */
    .modal {
      display: none; /* Hidden by default */
      position: fixed;
      z-index: 99;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body class="bg-gradient-to-r from-gray-800 to-gray-900 text-white min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gray-900 p-4 text-center font-cinzel text-4xl text-yellow-400 shadow-lg">
    MyWhelp Cloud System
  </header>

  <div class="container mx-auto p-4 flex-grow">
    <!-- Authentication Section -->
    <div id="auth-section" class="bg-gray-800 border border-yellow-500 p-8 mb-8 rounded-lg shadow-xl max-w-md mx-auto">
      <h2 class="text-3xl font-bold mb-4 text-center">Welcome to MyWhelp Cloud System!</h2>
      <p class="text-gray-300 mb-6 text-center">MyWhelp is your secure and convenient cloud platform designed to simplify your digital life. Easily **upload and manage your important files**, **create and store detailed reports**, and access your data anytime, anywhere. Experience seamless organization and reliable storage with MyWhelp.</p>

      <!-- Login fields - initially hidden -->
      <div id="login-fields" class="auth-fields hidden">
        <h3 class="text-2xl font-semibold mb-4 text-yellow-300">Login to your account</h3>
        <input type="email" id="loginEmail" placeholder="Email" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 mb-6 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <button onclick="login()" class="w-full bg-yellow-500 text-gray-900 font-bold py-3 px-6 rounded-md hover:bg-yellow-600 transition-colors duration-300 shadow-md">Login</button>
      </div>

      <!-- Register fields - initially hidden -->
      <div id="register-fields" class="auth-fields hidden">
        <h3 class="text-2xl font-semibold mb-4 text-yellow-300">Create a new account</h3>
        <input type="email" id="registerEmail" placeholder="Email" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <input type="password" id="registerPassword" placeholder="Password" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <input type="password" id="confirmPassword" placeholder="Confirm Password" class="w-full p-3 mb-6 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <button onclick="register()" class="w-full bg-yellow-500 text-gray-900 font-bold py-3 px-6 rounded-md hover:bg-yellow-600 transition-colors duration-300 shadow-md">Create Account</button>
      </div>

      <!-- Buttons to reveal specific forms -->
      <div class="flex justify-center space-x-4 mt-6">
        <button onclick="showLoginFields()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition-colors duration-300 shadow-md">Login</button>
        <button onclick="showRegisterFields()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-md hover:bg-green-700 transition-colors duration-300 shadow-md">Create Account</button>
      </div>
    </div>

    <!-- Main Application Sections (hidden until logged in) -->
    <div id="app-sections" class="hidden flex flex-col lg:flex-row gap-8">

      <!-- Sidebar Navigation -->
      <nav class="lg:w-1/4 bg-gray-800 p-6 rounded-lg shadow-xl">
        <h3 class="text-2xl font-semibold mb-6 text-yellow-300">Navigation</h3>
        <ul class="space-y-4">
          <li><button onclick="showSection('dashboard-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Dashboard</button></li>
          <li><button onclick="showSection('files-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Files</button></li>
          <li><button onclick="showSection('reports-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Reports</button></li>
          <li><button onclick="showSection('collaboration-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Collaboration</button></li>
          <li><button onclick="showSection('settings-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Settings</button></li>
          <li><button onclick="showSection('admin-section')" class="w-full text-left py-3 px-4 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-lg">Admin Panel</button></li>
          <li><button onclick="logout()" class="w-full text-left py-3 px-4 rounded-md bg-red-600 hover:bg-red-700 transition-colors duration-300 text-lg">Logout</button></li>
        </ul>
      </nav>

      <!-- Content Area -->
      <div class="lg:w-3/4 flex-grow">

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Dashboard</h2>
          <p class="text-gray-300 mb-4">Welcome back, <span id="dashboard-username" class="font-semibold text-yellow-400"></span>!</p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-blue-300">Storage Usage</h3>
              <p class="text-gray-300">Total files: <span id="total-files">0</span></p>
              <p class="text-gray-300">Total storage used: <span id="storage-used">0 MB</span></p>
              <div class="w-full bg-gray-600 rounded-full h-2.5 mt-3">
                <div class="bg-blue-500 h-2.5 rounded-full" style="width: 25%;"></div> <!-- Simulated usage -->
              </div>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-green-300">Recent Activity (Audit Trail)</h3>
              <ul id="recent-activity-list" class="text-sm text-gray-300 space-y-2">
                <li><span class="text-gray-400">2025-07-08 10:30 AM:</span> Logged in</li>
                <li><span class="text-gray-400">2025-07-08 10:25 AM:</span> Uploaded "ProjectPlan.docx"</li>
                <li><span class="text-gray-400">2025-07-07 04:15 PM:</span> Edited "WeeklyReport_0701.txt"</li>
              </ul>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-purple-300">Notifications</h3>
              <ul id="notification-list" class="text-sm text-gray-300 space-y-2">
                <li><span class="text-gray-400">New shared document: "Team Meeting Notes"</span></li>
                <li><span class="text-gray-400">Your monthly report is due soon!</span></li>
              </ul>
              <button class="mt-4 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition-colors duration-300">View All Notifications</button>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-orange-300">System Status</h3>
              <p class="text-gray-300">Data Encryption: <span class="text-green-400 font-semibold">Active (At Rest & In Transit)</span></p>
              <p class="text-gray-300">Automated Backups: <span class="text-green-400 font-semibold">Enabled (Daily)</span></p>
              <p class="text-gray-300">System Uptime: <span class="text-green-400 font-semibold">99.9%</span></p>
              <p class="text-gray-300">Scalability: <span class="text-green-400 font-semibold">Elastic & On-Demand</span></p>
            </div>
          </div>
        </div>

        <!-- Files Section -->
        <div id="files-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Files</h2>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">Upload File</h3>
            <input type="file" id="fileInput" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <button onclick="uploadFile()" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition-colors duration-300 shadow-md">Upload</button>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-green-300">Your Stored Files</h3>
            <div class="relative mb-4">
              <input type="text" id="fileSearchInput" placeholder="Search files..." class="w-full p-3 pr-10 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-green-500"/>
              <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <ul id="fileList" class="space-y-3">
              <!-- Files will be loaded here -->
              <li class="bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap">
                <span class="text-gray-300">No files uploaded yet.</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Reports</h2>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-purple-300">Create New Report</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button onclick="openReportModal('weekly')" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-700 transition-colors duration-300 shadow-md">Weekly Report</button>
              <button onclick="openReportModal('monthly')" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-700 transition-colors duration-300 shadow-md">Monthly Report</button>
              <button onclick="openReportModal('yearly')" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-700 transition-colors duration-300 shadow-md">Yearly Report</button>
            </div>
          </div>

          <div>
            <h3 class="text-xl font-semibold mb-3 text-orange-300">My Saved Reports</h3>
            <ul id="reportList" class="space-y-3">
              <!-- Reports will be loaded here -->
              <li class="bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap">
                <span class="text-gray-300">No reports saved yet.</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Collaboration Section -->
        <div id="collaboration-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Collaboration</h2>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">Share Document</h3>
            <input type="text" placeholder="Document Name" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <input type="email" placeholder="Recipient Email" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <select class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option>View Only</option>
              <option>Can Edit</option>
            </select>
            <button class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition-colors duration-300 shadow-md">Share</button>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-green-300">Shared With Me</h3>
            <ul class="space-y-3">
              <li class="bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap">
                <span class="text-gray-300">Team Project Plan (View Only)</span>
                <button class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors duration-300">Open</button>
              </li>
              <li class="bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap">
                <span class="text-gray-300">Marketing Strategy (Can Edit)</span>
                <button class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors duration-300">Open</button>
              </li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-semibold mb-3 text-purple-300">Document Comments & Versioning</h3>
            <div class="bg-gray-700 p-4 rounded-md mb-4">
              <p class="text-gray-300 text-sm mb-2">Comment on "ProjectProposal.docx": "Great start, let's refine section 3." - John Doe</p>
              <button class="bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700 transition-colors duration-300 text-sm">View History</button>
            </div>
            <p class="text-gray-400 text-sm">Version Control ensures you can track changes and revert to any previous state of your documents.</p>
          </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Settings</h2>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">Profile Settings</h3>
            <input type="text" placeholder="Full Name" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <input type="email" placeholder="Email" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" disabled />
            <button class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition-colors duration-300 shadow-md">Update Profile</button>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-green-300">Notification Preferences</h3>
            <div class="flex items-center mb-2">
              <input type="checkbox" id="emailNotifications" class="form-checkbox h-5 w-5 text-green-600 rounded" checked>
              <label for="emailNotifications" class="ml-2 text-gray-300">Email Notifications</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" id="inAppNotifications" class="form-checkbox h-5 w-5 text-green-600 rounded" checked>
              <label for="inAppNotifications" class="ml-2 text-gray-300">In-App Notifications</label>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 text-purple-300">Security & Access</h3>
            <p class="text-gray-300 mb-2">Granular Access Controls: Manage specific permissions for your files and folders.</p>
            <button class="bg-purple-600 text-white font-bold py-3 px-6 rounded-md hover:bg-purple-700 transition-colors duration-300 shadow-md">Manage Permissions</button>
            <p class="text-gray-300 mt-4">Single Sign-On (SSO) Integration: Seamlessly log in with your existing enterprise credentials.</p>
          </div>

          <div>
            <h3 class="text-xl font-semibold mb-3 text-orange-300">System Integration (APIs)</h3>
            <p class="text-gray-300 mb-2">Our system provides robust APIs for seamless integration with your existing business applications.</p>
            <button class="bg-orange-600 text-white font-bold py-3 px-6 rounded-md hover:bg-orange-700 transition-colors duration-300 shadow-md">View API Documentation</button>
            <p class="text-gray-300 mt-4">Customizable Branding: Tailor the look and feel of your cloud system to match your organization's identity.</p>
          </div>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin-section" class="main-app-section bg-gray-800 border border-yellow-500 p-8 rounded-lg shadow-xl hidden">
          <h2 class="text-3xl font-bold mb-6 text-yellow-300">Admin Panel</h2>
          <p class="text-red-400 mb-4">Note: This section is for administrative users only.</p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-blue-300">User Management</h3>
              <ul class="space-y-2 text-gray-300">
                <li>John Doe (john.doe@example.com) - Active</li>
                <li>Jane Smith (jane.smith@example.com) - Active</li>
                <li>Bob Johnson (bob.j@example.com) - Inactive</li>
              </ul>
              <button class="mt-4 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-300">Add New User</button>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-green-300">System Performance</h3>
              <p class="text-gray-300">CPU Usage: <span class="text-green-400">15%</span></p>
              <p class="text-gray-300">Memory Usage: <span class="text-green-400">30%</span></p>
              <p class="text-gray-300">Network Latency: <span class="text-green-400">20ms</span></p>
              <button class="mt-4 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors duration-300">View Detailed Metrics</button>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-purple-300">Security Monitoring & Compliance</h3>
              <p class="text-gray-300">Last Security Scan: <span class="text-green-400">2025-07-08 (No Threats Detected)</span></p>
              <p class="text-gray-300">Compliance Status: <span class="text-green-400">GDPR, ISO 27001 Certified</span></p>
              <button class="mt-4 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition-colors duration-300">View Security Logs</button>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md">
              <h3 class="text-xl font-semibold mb-3 text-orange-300">Cost Management</h3>
              <p class="text-gray-300">Current Month Usage: <span class="text-yellow-400">$125.00</span></p>
              <p class="text-gray-300">Projected Annual Cost: <span class="text-yellow-400">$1500.00</span></p>
              <button class="mt-4 bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 transition-colors duration-300">View Billing Details</button>
            </div>

            <div class="bg-gray-700 p-6 rounded-lg shadow-md md:col-span-2">
              <h3 class="text-xl font-semibold mb-3 text-red-300">Disaster Recovery & Data Retention</h3>
              <p class="text-gray-300">Last Recovery Drill: <span class="text-green-400">2025-06-15 (Successful)</span></p>
              <p class="text-gray-300">Data Retention Policy: <span class="text-yellow-400">7 years for critical data</span></p>
              <button class="mt-4 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors duration-300">Initiate Manual Backup</button>
            </div>
          </div>
        </div>

      </div> <!-- End Content Area -->
    </div> <!-- End App Sections -->
  </div> <!-- End Container -->

  <!-- Footer -->
  <footer class="bg-gray-900 text-center p-4 text-gray-400 text-sm shadow-inner">
    &copy; 2025 MyWhelp Cloud System. All rights reserved.
    <p class="mt-2">Need help? <a href="#" class="text-blue-400 hover:underline">Visit our Support Center</a></p>
  </footer>

  <!-- Report Modal (for writing reports) -->
  <div class="modal" id="reportModal">
    <div class="modal-content bg-gray-800 text-white p-8 rounded-lg shadow-xl w-11/12 max-w-xl">
      <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-yellow-300">Create Report</h3>
      <p id="reportGreeting" class="text-gray-300 mb-6"></p>
      <input type="text" id="regionInput" placeholder="Region" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      <input type="text" id="territoryInput" placeholder="Territory" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      <input type="text" id="sectionInput" placeholder="Section" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      <input type="date" id="reportDateInput" class="w-full p-3 mb-4 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      <textarea id="reportText" rows="6" placeholder="Write your report here..." class="w-full p-3 mb-6 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
      <div class="flex justify-end space-x-4">
        <button onclick="saveReport()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-md hover:bg-green-700 transition-colors duration-300 shadow-md">Save Report</button>
        <button onclick="closeReportModal()" class="bg-red-600 text-white font-bold py-3 px-6 rounded-md hover:bg-red-700 transition-colors duration-300 shadow-md">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Generic Message Modal (for simple alerts/confirmations) -->
  <div class="modal" id="messageModal">
    <div class="modal-content bg-gray-800 text-white p-8 rounded-lg shadow-xl w-11/12 max-w-md">
      <h3 id="messageModalTitle" class="text-2xl font-bold mb-4 text-yellow-300">Message</h3>
      <p id="messageModalText" class="text-gray-300 mb-6"></p>
      <div id="messageModalButtons" class="flex justify-center space-x-4">
        <!-- Buttons will be dynamically added here -->
      </div>
    </div>
  </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      signOut,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
      getStorage,
      ref,
      uploadBytes,
      listAll,
      getDownloadURL,
      deleteObject
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    // Initialize EmailJS with your public key.
    // IMPORTANT: Replace 'YOUR_PUBLIC_KEY' with your actual EmailJS public key.
    emailjs.init("TEn7z0_oc1iqKHPVi"); // REMEMBER TO REPLACE THIS WITH YOUR ACTUAL PUBLIC KEY

    // Firebase Configuration - This is safe to expose in client-side code
    const firebaseConfig = {
      apiKey: "AIzaSyCOc_f94DMGC5XVI2rf1baKp5lWJWnkrKo",
      authDomain: "samrad-quiz.firebaseapp.com",
      projectId: "samrad-quiz",
      storageBucket: "samrad-quiz.appspot.com",
      messagingSenderId: "853162839858",
      appId: "1:853162839858:web:9eb0fde5b5a442a067d12b"
    };

    // Initialize Firebase services
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);

    let currentUser = null; // Stores the currently logged-in user
    let reportType = ''; // Stores the type of report being created

    // Get references to HTML elements
    const authSection = document.getElementById("auth-section");
    const appSectionsContainer = document.getElementById("app-sections");
    const loginFields = document.getElementById("login-fields");
    const registerFields = document.getElementById("register-fields");

    // Main application sections
    const dashboardSection = document.getElementById("dashboard-section");
    const filesSection = document.getElementById("files-section");
    const downloadSection = document.getElementById("download-section"); // This is now part of filesSection
    const reportSection = document.getElementById("reports-section");
    const myReportsSection = document.getElementById("my-reports-section"); // This is now part of reportsSection
    const collaborationSection = document.getElementById("collaboration-section");
    const settingsSection = document.getElementById("settings-section");
    const adminSection = document.getElementById("admin-section");
    const logoutSection = document.getElementById("logout-section"); // This is now a button in the nav

    const fileList = document.getElementById("fileList");
    const reportList = document.getElementById("reportList");
    const reportModal = document.getElementById("reportModal");
    const modalTitle = document.getElementById("modalTitle");
    const reportText = document.getElementById("reportText");
    const dashboardUsername = document.getElementById("dashboard-username");
    const totalFilesSpan = document.getElementById("total-files");
    const storageUsedSpan = document.getElementById("storage-used");

    // Generic Message Modal elements
    const messageModal = document.getElementById("messageModal");
    const messageModalTitle = document.getElementById("messageModalTitle");
    const messageModalText = document.getElementById("messageModalText");
    const messageModalButtons = document.getElementById("messageModalButtons");

    /**
     * Displays a generic message modal with custom buttons.
     * @param {string} title - The title of the modal.
     * @param {string} message - The message to display.
     * @param {Array<Object>} buttons - An array of button configurations:
     * [{ text: 'Button Text', className: 'optional-class', onClick: function }]
     */
    function showMessageModal(title, message, buttons = [{ text: 'OK', onClick: closeModal }]) {
        messageModalTitle.innerText = title;
        messageModalText.innerText = message;
        messageModalButtons.innerHTML = ''; // Clear previous buttons

        buttons.forEach(btnConfig => {
            const button = document.createElement('button');
            button.innerText = btnConfig.text;
            // Apply Tailwind classes for modal buttons
            button.classList.add('bg-blue-600', 'text-white', 'font-bold', 'py-2', 'px-4', 'rounded-md', 'hover:bg-blue-700', 'transition-colors', 'duration-300', 'shadow-md');
            if (btnConfig.className) {
                // Specific classes for confirmation buttons
                if (btnConfig.className === 'confirm-no') {
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-gray-500', 'hover:bg-gray-600');
                } else if (btnConfig.className === 'confirm-yes') {
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-red-600', 'hover:bg-red-700');
                }
            }
            button.onclick = () => {
                closeModal(); // Close message modal first
                if (btnConfig.onClick) {
                    btnConfig.onClick();
                }
            };
            messageModalButtons.appendChild(button);
        });
        messageModal.style.display = "flex"; // Use flex to center with Tailwind
    }

    /**
     * Closes the generic message modal.
     */
    function closeModal() {
        messageModal.style.display = "none";
    }

    /**
     * Shows a specific main application section and hides others.
     * @param {string} sectionId - The ID of the section to show.
     */
    window.showSection = function(sectionId) {
        document.querySelectorAll('.main-app-section').forEach(section => {
            section.classList.add('hidden');
        });
        document.getElementById(sectionId).classList.remove('hidden');
    };

    /**
     * Shows the main application sections and hides the authentication section.
     * Also triggers loading of files and reports for the current user.
     */
    function showApp() {
      authSection.classList.add("hidden");
      appSectionsContainer.classList.remove("hidden");
      dashboardUsername.innerText = currentUser.displayName || currentUser.email;
      showSection('dashboard-section'); // Show dashboard by default after login
      loadFiles();
      loadReports();
    }

    /**
     * Hides the main application sections and shows the authentication section.
     * Clears user-specific data and input fields.
     */
    function hideApp() {
        authSection.classList.remove("hidden");
        appSectionsContainer.classList.add("hidden");

        // Clear content when logged out
        fileList.innerHTML = '';
        reportList.innerHTML = '';
        totalFilesSpan.innerText = '0';
        storageUsedSpan.innerText = '0 MB';

        // Clear input fields for both login and register forms
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('registerEmail').value = '';
        document.getElementById('registerPassword').value = '';
        document.getElementById('confirmPassword').value = '';

        // Hide both login and register fields
        loginFields.classList.add("hidden");
        registerFields.classList.add("hidden");
    }

    /**
     * Shows the login fields and hides register fields.
     */
    window.showLoginFields = function() {
        loginFields.classList.remove("hidden");
        registerFields.classList.add("hidden");
    };

    /**
     * Shows the register fields and hides login fields.
     */
    window.showRegisterFields = function() {
        registerFields.classList.remove("hidden");
        loginFields.classList.add("hidden");
    };

    /**
     * Handles user login with email and password.
     */
    window.login = function () {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        if (!email || !password) {
            showMessageModal("Login Error", "Please enter both email and password.");
            return;
        }

        signInWithEmailAndPassword(auth, email, password)
            .then(({ user }) => {
                currentUser = user;
                showMessageModal("Login Success", "You have successfully logged in!");
                showApp();
            })
            .catch(err => {
                showMessageModal("Login Failed", "Error: " + err.message);
            });
    };

    /**
     * Handles user registration with email and password, then allows setting full name.
     */
    window.register = function () {
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (!email || !password || !confirmPassword) {
            showMessageModal("Registration Error", "Please fill in all fields.");
            return;
        }

        if (password !== confirmPassword) {
            showMessageModal("Registration Error", "Passwords do not match.");
            return;
        }

        createUserWithEmailAndPassword(auth, email, password)
            .then(async ({ user }) => {
                const fullName = prompt("Enter your full name (optional):");
                if (fullName) {
                    await updateProfile(user, { displayName: fullName });
                }
                currentUser = user;
                showMessageModal("Registration Successful", "Your account has been created and you are now logged in.");
                showApp();
            })
            .catch(err => {
                showMessageModal("Registration Failed", "Error: " + err.message);
            });
    };

    /**
     * Uploads a selected file to Firebase Storage.
     */
    window.uploadFile = function () {
      if (!currentUser) {
        showMessageModal("Upload Error", "You must be logged in to upload files.");
        return;
      }
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      if (!file) {
        showMessageModal("Upload Error", "Please select a file first.");
        return;
      }

      const storageRef = ref(storage, `uploads/${currentUser.uid}/${file.name}`);
      uploadBytes(storageRef, file)
        .then(() => {
          fileInput.value = ''; // Clear the file input
          loadFiles(); // Refresh the file list
          showMessageModal(
            "Upload Successful!",
            "Your file has been uploaded successfully.",
            [
              { text: 'Go to Files', onClick: () => showSection('files-section') },
              { text: 'Upload Another File', onClick: () => {} }
            ]
          );
        })
        .catch(err => showMessageModal("Upload Failed", "Error: " + err.message));
    };

    /**
     * Loads and displays the current user's uploaded files from Firebase Storage.
     * Also updates storage usage statistics.
     */
    function loadFiles() {
      if (!currentUser) {
        fileList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Please log in to see your files.</li>";
        totalFilesSpan.innerText = '0';
        storageUsedSpan.innerText = '0 MB';
        return;
      }

      const userFilesRef = ref(storage, `uploads/${currentUser.uid}/`);
      fileList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Loading files...</li>";
      let totalSize = 0;
      let fileCount = 0;

      listAll(userFilesRef)
        .then(res => {
          fileList.innerHTML = ""; // Clear "Loading..."
          if (res.items.length === 0) {
            fileList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>No files uploaded yet.</li>";
            totalFilesSpan.innerText = '0';
            storageUsedSpan.innerText = '0 MB';
            return;
          }

          res.items.forEach(itemRef => {
            getDownloadURL(itemRef).then(url => {
              // Get file metadata to calculate size
              itemRef.getMetadata().then(metadata => {
                totalSize += metadata.size;
                fileCount++;

                const li = document.createElement("li");
                li.className = "bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap";
                li.innerHTML = `
                  <a href="${url}" target="_blank" class="text-blue-400 hover:underline flex-grow mr-4 break-all">${itemRef.name}</a>
                  <div class="flex space-x-2 mt-2 md:mt-0">
                    <button onclick="viewFileHistory('${itemRef.fullPath}')" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors duration-300 text-sm">History</button>
                    <button onclick="shareFile('${itemRef.name}')" class="bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700 transition-colors duration-300 text-sm">Share</button>
                    <button onclick="deleteFile('${itemRef.fullPath}')" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors duration-300 text-sm">Delete</button>
                  </div>
                `;
                fileList.appendChild(li);

                totalFilesSpan.innerText = fileCount;
                storageUsedSpan.innerText = (totalSize / (1024 * 1024)).toFixed(2) + ' MB'; // Convert bytes to MB
              }).catch(err => console.error("Error getting file metadata:", err));
            });
          });
        })
        .catch(err => {
          console.error("Failed to list files:", err);
          fileList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Error loading files.</li>";
          totalFilesSpan.innerText = '0';
          storageUsedSpan.innerText = '0 MB';
        });
    }

    /**
     * Simulates viewing file history (version control).
     * @param {string} fullPath - The full path of the file.
     */
    window.viewFileHistory = function(fullPath) {
        showMessageModal("File History", `Displaying version history for: ${fullPath.split('/').pop()}\n\n(Feature under development: This would show a list of previous versions and allow restoration.)`);
    };

    /**
     * Simulates sharing a file.
     * @param {string} fileName - The name of the file to share.
     */
    window.shareFile = function(fileName) {
        showMessageModal("Share File", `Sharing "${fileName}" with other users.\n\n(Feature under development: This would open a detailed sharing interface with access controls.)`);
    };

    /**
     * Deletes a file from Firebase Storage.
     * @param {string} fullPath The full path of the file to delete.
     */
    window.deleteFile = function(fullPath) {
        showMessageModal(
            "Confirm Deletion",
            "Are you sure you want to delete this file? This action cannot be undone.",
            [
                { text: 'No, Cancel', className: 'confirm-no', onClick: () => {} },
                { text: 'Yes, Delete', className: 'confirm-yes', onClick: () => {
                    const fileRef = ref(storage, fullPath);
                    deleteObject(fileRef)
                        .then(() => {
                            showMessageModal("Deletion Successful", "File deleted successfully!");
                            loadFiles(); // Refresh the file list
                        })
                        .catch(err => {
                            showMessageModal("Deletion Failed", "Error deleting file: " + err.message);
                            console.error("Delete file error:", err);
                        });
                }}
            ]
        );
    };

    /**
     * Opens the report creation modal with the specified report type.
     * @param {string} type The type of report (e.g., 'weekly', 'monthly', 'yearly').
     */
    window.openReportModal = function(type) {
        reportType = type;
        modalTitle.innerText = `${type.charAt(0).toUpperCase() + type.slice(1)} Report`;

        reportText.value = "";
        document.getElementById("regionInput").value = "";
        document.getElementById("territoryInput").value = "";
        document.getElementById("sectionInput").value = "";
        document.getElementById("reportDateInput").value = "";

        const name = currentUser.displayName || currentUser.email;
        document.getElementById("reportGreeting").innerText = `Greetings brethren ${name}`;

        reportModal.style.display = "flex";
    };

    /**
     * Closes the report creation modal.
     */
    window.closeReportModal = function() {
      reportModal.style.display = "none";
    };

    /**
     * Saves the created report to Firebase Storage.
     */
    window.saveReport = function () {
        if (!currentUser) {
            showMessageModal("Save Error", "You must be logged in to save reports.");
            return;
        }

        const region = document.getElementById("regionInput").value.trim();
        const territory = document.getElementById("territoryInput").value.trim();
        const section = document.getElementById("sectionInput").value.trim();
        const date = document.getElementById("reportDateInput").value;
        const content = document.getElementById("reportText").value.trim();

        if (!region || !territory || !section || !date || !content) {
            showMessageModal("Missing Info", "Please fill in all fields.");
            return;
        }

        const name = currentUser.displayName || currentUser.email;
        const fullContent = `
Greetings brethren ${name}
Region: ${region}
Territory: ${territory}
Section: ${section}
Date of Report: ${date}

Report Details:
${content}
        `.trim();

        const now = new Date();
        const dateString = now.toISOString().replace(/[:.]/g, '-');
        const fileName = `${reportType}_report_${dateString}.txt`;
        const blob = new Blob([fullContent], { type: "text/plain" });
        const reportRef = ref(storage, `reports/${currentUser.uid}/${fileName}`);

        uploadBytes(reportRef, blob)
            .then(() => {
                reportModal.style.display = "none"; // Hide report modal immediately
                loadReports(); // Refresh list

                // Show 5-second countdown message
                messageModalTitle.innerText = "Report Saved!";
                messageModalText.innerText = "Your report has been saved successfully. Closing in 5 seconds...";
                messageModalButtons.innerHTML = "";
                messageModal.style.display = "flex";

                setTimeout(() => {
                    showMessageModal("Next Action", "Choose what to do next:", [
                        { text: "Go to My Reports", onClick: () => showSection('reports-section') },
                        { text: "Write Another Report", onClick: () => openReportModal(reportType) }
                    ]);
                }, 5000);
            })
            .catch(err => {
                showMessageModal("Save Failed", "Error: " + err.message);
            });
    };

    /**
     * Loads and displays the current user's saved reports from Firebase Storage.
     */
    function loadReports() {
      if (!currentUser) {
        reportList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Please log in to see your reports.</li>";
        return;
      }

      const userReportRef = ref(storage, `reports/${currentUser.uid}/`);
      reportList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Loading reports...</li>";

      listAll(userReportRef)
        .then(res => {
          reportList.innerHTML = ""; // Clear "Loading..."
          if (res.items.length === 0) {
            reportList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>No reports saved yet.</li>";
            return;
          }

          res.items.forEach(itemRef => {
            getDownloadURL(itemRef).then(url => {
              const li = document.createElement("li");
              li.className = "bg-gray-700 p-4 rounded-md flex items-center justify-between flex-wrap";
              li.innerHTML = `
                <a href="${url}" target="_blank" class="text-blue-400 hover:underline flex-grow mr-4 break-all">${itemRef.name}</a>
                <div class="flex space-x-2 mt-2 md:mt-0">
                    <button onclick="deleteReport('${itemRef.fullPath}')" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors duration-300 text-sm">Delete</button>
                </div>
              `;
              reportList.appendChild(li);
            });
          });
        })
        .catch(err => {
          console.error("Failed to list reports:", err);
          reportList.innerHTML = "<li class='bg-gray-700 p-4 rounded-md text-gray-300'>Error loading reports.</li>";
        });
    }

    /**
     * Deletes a report from Firebase Storage.
     * @param {string} fullPath The full path of the report to delete.
     */
    window.deleteReport = function(fullPath) {
        showMessageModal(
            "Confirm Deletion",
            "Are you sure you want to delete this report? This action cannot be undone.",
            [
                { text: 'No, Cancel', className: 'confirm-no', onClick: () => {} },
                { text: 'Yes, Delete', className: 'confirm-yes', onClick: () => {
                    const reportRef = ref(storage, fullPath);
                    deleteObject(reportRef)
                        .then(() => {
                            showMessageModal("Deletion Successful", "Report deleted successfully!");
                            loadReports(); // Refresh the report list
                        })
                        .catch(err => {
                            showMessageModal("Deletion Failed", "Error deleting report: " + err.message);
                            console.error("Delete report error:", err);
                        });
                }}
            ]
        );
    };

    /**
     * Handles user logout.
     */
    window.logout = function() {
        showMessageModal(
            "Confirm Logout",
            "Are you sure you want to log out?",
            [
                { text: 'No, Stay Logged In', className: 'confirm-no', onClick: () => {} },
                { text: 'Yes, Log Out', className: 'confirm-yes', onClick: () => {
                    signOut(auth).then(() => {
                        currentUser = null;
                        showMessageModal("Logged Out", "You have been successfully logged out.");
                        hideApp(); // Use hideApp to reset UI
                    }).catch((error) => {
                        showMessageModal("Logout Error", "Error logging out: " + error.message);
                        console.error("Logout error:", error);
                    });
                }}
            ]
        );
    };

    // Listen for authentication state changes
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        showApp(); // Show the main application if logged in
      } else {
        currentUser = null;
        hideApp(); // Hide application and show auth section if logged out
      }
    });

    // Initial check for offline status (simulated)
    window.addEventListener('load', () => {
        if (!navigator.onLine) {
            showMessageModal("Offline Mode", "You are currently offline. Some features may be limited. Changes will sync when online.");
        }
    });

    // Simulate search functionality (for files)
    document.getElementById('fileSearchInput').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const items = fileList.getElementsByTagName('li');
        for (let i = 0; i < items.length; i++) {
            const fileName = items[i].querySelector('a')?.innerText.toLowerCase() || '';
            if (fileName.includes(searchTerm) || searchTerm === '') {
                items[i].classList.remove('hidden');
            } else {
                items[i].classList.add('hidden');
            }
        }
    });

  </script>
</body>
</html>
